import{O as R,P as W,o as $,e as P,g as j,r as T,b as O,w as H,D as Z,d as G,v as U,x as K,z as V}from"./modules/vue-DtEGhQT5.js";import{u as B,f as X}from"./slidev/context-B8_C1T5K.js";import{p as E}from"./app-Ddl2Q9KC.js";import{I as Y}from"./slidev/center-CB5RFvN-.js";import"./index-Cs3j3FI-.js";import"./modules/shiki--QlaK0aY.js";import"./modules/file-saver-Ds2qT4Ee.js";class N{static VERSION="3.4.13";static factory(t){return this.isFunction(t)&&(t._isFactory=!0),t}static singleton(t){return t}static _textColor="DodgerBlue";static get textColor(){return this._textColor}static set textColor(t){this._textColor=typeof t=="string"||this.isColor(t)?t:this._textColor}static _textZoom=.78;static get textZoom(){return this._textZoom}static set textZoom(t){this._textZoom=typeof t=="number"&&t>0?t:this._textZoom}static _outline="OrangeRed";static get outline(){return this._outline}static set outline(t){this._outline=typeof t=="string"||this.isColor(t)?t:this._outline}static _outlineWeight=2;static get outlineWeight(){return this._outlineWeight}static set outlineWeight(t){this._outlineWeight=typeof t=="number"&&t>=0?t:this._outlineWeight}static _cellLength=100;static get cellLength(){return this._cellLength}static set cellLength(t){this._cellLength=typeof t=="number"&&t>0?t:this._cellLength}static _background="white";static get background(){return this._background}static set background(t){this._background=typeof t=="string"||this.isColor(t)?t:this._background}static _darkSquare="#D28C45";static get darkSquare(){return this._darkSquare}static set darkSquare(t){this._darkSquare=typeof t=="string"||this.isColor(t)?t:this._darkSquare}static _lightSquare="#FDCDAA";static get lightSquare(){return this._lightSquare}static set lightSquare(t){this._lightSquare=typeof t=="string"||this.isColor(t)?t:this._lightSquare}static _chessSymbols=new Map([["K","♔"],["Q","♕"],["R","♖"],["B","♗"],["N","♘"],["P","♙"],["k","♚"],["q","♛"],["r","♜"],["b","♝"],["n","♞"],["p","♟"]]);static get chessSymbols(){return new Map(this._chessSymbols)}static set chessSymbols(t){if(t instanceof Map)for(const[i,s]of t)this._chessSymbols.set(i,s);else for(const[i,s]of Object.entries(t))this._chessSymbols.set(i,s)}static get chessKeys(){return new Map([...this._chessSymbols].map(([t,i])=>[i,t]))}static bitIndex(t,i,s=8,e=8,n=!1){if(t<0||t>=e||i<0||i>=s){const h=[];t<0&&h.push(`height ≥ ${e-t}`),t>=e&&h.push(`height ≥ ${t+1}`),i<0&&h.push(`width ≥ ${s-i}`),i>=s&&h.push(`width ≥ ${i+1}`),console.warn(`Ignored out-of-bounds cell (${t}, ${i}) for quadrille size ${s}×${e}.`+(h.length?` Suggested: ${h.join(", ")}.`:""));return}const o=t*s+i;return n?o:s*e-1-o}static bitCell(t,i=8,s=8,e=!1){const n=i*s-1,o=Number(t);if(o<0||o>n){console.warn(`Ignored out-of-bounds bit index ${t} for quadrille size ${i}×${s}. Expected range: 0–${n}.`);return}const h=e?o:n-o;return{row:Math.floor(h/i),col:h%i}}static and(t,i,s,e){return this.merge(t,i,(n,o)=>{if(this.isFilled(n)&&this.isFilled(o))return n},s,e)}static or(t,i,s,e){return this.merge(t,i,(n,o)=>{if(this.isFilled(n))return n;if(this.isFilled(o))return o},s,e)}static xor(t,i,s,e){return this.merge(t,i,(n,o)=>{if(this.isFilled(n)&&this.isEmpty(o))return n;if(this.isEmpty(n)&&this.isFilled(o))return o},s,e)}static diff(t,i,s,e){return this.merge(t,i,(n,o)=>{if(this.isFilled(n)&&this.isEmpty(o))return n},s,e)}static merge(t,i,s,e,n){const o=t._row!==void 0&&i._row!==void 0&&t._cellLength!==void 0&&t._cellLength===i._cellLength;e??=o?i._row-t._row:0,n??=o?i._col-t._col:0;const h=n<0?Math.max(i.width,t.width-n):Math.max(t.width,i.width+n),r=e<0?Math.max(i.height,t.height-e):Math.max(t.height,i.height+e),c=this._allocNullMemory(r,h);for(let l=0;l<r;l++){const m=c[l],b=e<0?l+e:l,d=e>0?l-e:l;for(let u=0;u<h;u++){const f=n<0?u+n:u,_=n>0?u-n:u,A=t.read(b,f),I=i.read(d,_),S=s(A,I);m[u]=this.isFilled(S)?S:null}}return this._allocQ(t,c)}static _allocNullMemory(t,i){const s=new Array(t);for(let e=0;e<t;e++){const n=new Array(i);for(let o=0;o<i;o++)n[o]=null;s[e]=n}return s}static _allocQ(t,i,s){const e=t.constructor,n=Array.isArray(i)?i:this._allocNullMemory(i,s),o=Object.create(e.prototype);return o._p=t._p,o._memory2D=n,o._cellLength=e.cellLength,o._x=0,o._y=0,o._origin="corner",o}static not(t,i){return t.clone().not(i)}static shift(t,i,s,e=!0){return t.clone().shift(i,s,e)}constructor(t,...i){if(this._p=t,this._cellLength=this.constructor.cellLength,this._x=0,this._y=0,this._origin="corner",i.length===0){this._memory2D=Array(8).fill().map(()=>Array(8).fill(null)),this.visit(({row:s,col:e})=>{const n=(s+e)%2===0?this.constructor.lightSquare:this.constructor.darkSquare;this._memory2D[s][e]=this._p.color(n)});return}if(i.length===1){this.memory2D=i[0];return}if(i.length===2&&(this.constructor.isColor(i[0])||typeof i[0]=="string")&&(this.constructor.isColor(i[1])||typeof i[1]=="string")){this._memory2D=Array(8).fill().map(()=>Array(8).fill(null)),this.visit(({row:s,col:e})=>{const n=(s+e)%2===0?i[0]:i[1];this._memory2D[s][e]=this._p.color(n)});return}if(i.length===2&&typeof i[0]=="number"){if(typeof i[1]=="string"){this._init1D([...i[1]],i[0]);return}if(Array.isArray(i[1])){this._init1D(i[1],i[0]);return}}if(i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"){this._memory2D=Array(i[1]).fill().map(()=>Array(i[0]).fill(null));return}if(i.length===2&&typeof i[0]=="number"&&typeof i[1]!="number"){this._memory2D=Array(Math.round(i[0]*i[1].height/i[1].width)).fill().map(()=>Array(i[0]).fill(null)),this._fromImage(i[1]);return}if(i.length===3&&typeof i[0]=="number"&&typeof i[1]=="bigint"){const s=i[1].toString(2).length,e=Math.ceil(s/i[0]);this._memory2D=Array(e).fill().map(()=>Array(i[0]).fill(null)),this.fill(i[1],i[2]);return}if(i.length===4&&typeof i[0]=="number"&&typeof i[1]=="bigint"&&typeof i[3]=="boolean"){const s=i[1].toString(2).length,e=Math.ceil(s/i[0]);this._memory2D=Array(e).fill().map(()=>Array(i[0]).fill(null)),this.fill(i[1],i[2],i[3]);return}if(i.length===3&&typeof i[0]=="number"&&typeof i[1]!="number"&&typeof i[2]=="boolean"){this._memory2D=Array(Math.round(i[0]*i[1].height/i[1].width)).fill().map(()=>Array(i[0]).fill(null)),this._fromImage(i[1],i[2]);return}if(i.length===4&&typeof i[0]=="number"&&typeof i[1]=="number"&&typeof i[2]=="function"){this._memory2D=Array(i[1]).fill().map(()=>Array(i[0]).fill(null)),this.fill(i[2],i[3]);return}if(i.length===4&&typeof i[0]=="number"&&typeof i[1]=="number"&&typeof i[2]=="number"){this._memory2D=Array(i[1]).fill().map(()=>Array(i[0]).fill(null)),this.rand(i[2],i[3]);return}if(i.length===4&&typeof i[0]=="number"&&typeof i[1]=="number"&&typeof i[2]=="bigint"){this._memory2D=Array(i[1]).fill().map(()=>Array(i[0]).fill(null)),this.fill(i[2],i[3]);return}if(i.length===5&&typeof i[0]=="number"&&typeof i[1]=="number"&&typeof i[2]=="bigint"&&typeof i[4]=="boolean"){this._memory2D=Array(i[1]).fill().map(()=>Array(i[0]).fill(null)),this.fill(i[2],i[3],i[4]);return}}_init1D(t,i=t.length){const s=Math.ceil(t.length/i);this._memory2D=Array.from({length:s},(e,n)=>{const o=n*i;return this._format(t.slice(o,o+i),i)})}_format(t,i){const s=t.map(e=>e===void 0?null:e);return s.length<i?s.concat(new Array(i-s.length).fill(null)):s}_fromFEN(...t){if(typeof t[0]=="string"&&t[0].split("/").length-1===7){const[i]=t[0].split(" ");this._memory2D=Array(8).fill().map(()=>Array(8).fill(null));const s=i.split("/");for(let e=0;e<8;e++){let n=0;for(const o of s[e])isNaN(o)?(this._memory2D[e][n]=this.constructor._chessSymbols.get(o),n++):n+=parseInt(o)}}}_fromImage(...t){if(this.constructor.isImage(t[0])){let i=t[0]instanceof E.Framebuffer?t[0].get():t[0];if(i instanceof E.MediaElement&&i.elt instanceof HTMLVideoElement){const e=i.elt;if(e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA){e.addEventListener("loadeddata",()=>this._fromImage(...t));return}i=new E.Image(e.videoWidth,e.videoHeight),i.drawingContext.drawImage(e,0,0,e.videoWidth,e.videoHeight)}const s=new E.Image(i.width,i.height);s.copy(i,0,0,i.width,i.height,0,0,i.width,i.height),t.length===1?this._images(s):t[1]?this._pixelator1(s):this._pixelator2(s)}}_pixelator1(t){t.resize(this.width,this.height),t.loadPixels();for(let i=0;i<t.pixels.length/4;i++){const s=t.pixels[4*i],e=t.pixels[4*i+1],n=t.pixels[4*i+2],o=t.pixels[4*i+3],h=this._fromIndex(i);this.fill(h.row,h.col,this._p.color([s,e,n,o]))}}_pixelator2(t){t.loadPixels();const i=Array(this.height).fill().map(()=>Array(this.width).fill(0)),s=Array(this.height).fill().map(()=>Array(this.width).fill(0)),e=Array(this.height).fill().map(()=>Array(this.width).fill(0)),n=Array(this.height).fill().map(()=>Array(this.width).fill(0)),o=Array(this.height).fill().map(()=>Array(this.width).fill(0));for(let h=0;h<t.pixels.length/4;h++){const r=this._fromIndex(h,t.width),c=Math.floor(r.row*this.height/t.height),l=Math.floor(r.col*this.width/t.width);i[c][l]+=t.pixels[4*h],s[c][l]+=t.pixels[4*h+1],e[c][l]+=t.pixels[4*h+2],n[c][l]+=t.pixels[4*h+3],o[c][l]+=1}this.visit(({row:h,col:r})=>{this.fill(h,r,this._p.color([i[h][r]/o[h][r],s[h][r]/o[h][r],e[h][r]/o[h][r],n[h][r]/o[h][r]]))})}_images(t){const i=t.width/this.width,s=t.height/this.height;this.visit(({row:e,col:n})=>this.fill(e,n,t.get(n*i,e*s,i,s)))}_fromIndex(t,i=this.width){return{row:t/i|0,col:t%i}}_toIndex(t,i,s=this.width){return t*s+i}bitIndex(t,i,s=!1){return this.constructor.bitIndex(t,i,this.width,this.height,s)}bitCell(t,i=!1){return this.constructor.bitCell(t,this.width,this.height,i)}visit(t,i){const s=this._memory2D,e=this.height,n=this.width;if(i==null){for(let h=0;h<e;h++){const r=s[h];for(let c=0;c<n;c++)t({row:h,col:c,value:r[c]})}return}if(i&&typeof i.has=="function"||Array.isArray(i)){const h=Array.isArray(i)?new Set(i):i;for(let r=0;r<e;r++){const c=s[r];for(let l=0;l<n;l++){const m=c[l];h.has(m)&&t({row:r,col:l,value:m})}}return}if(typeof i=="function"){for(let h=0;h<e;h++){const r=s[h];for(let c=0;c<n;c++){const l={row:h,col:c,value:r[c]};i(l)&&t(l)}}return}const o=i;for(let h=0;h<e;h++){const r=s[h];for(let c=0;c<n;c++){const l=r[c];l===o&&t({row:h,col:c,value:l})}}}set memory2D(t){if(typeof t=="string"){t.split("/").length-1===7?this._fromFEN(t):this._init1D([...t]);return}if(Array.isArray(t)&&!Array.isArray(t[0])){this._init1D(t);return}if(Array.isArray(t)){const i=t.map(e=>{if(!Array.isArray(e))throw new Error("Not 2D Array");return e.slice()}),s=Math.max(...i.map(e=>e.length));this._memory2D=i.map(e=>this._format(e,s))}}get memory2D(){return this.clone()._memory2D}set width(t){this.transpose(),this.height=t,this.transpose()}get width(){return this._memory2D[0].length}set height(t){t=Math.max(1,Math.abs(t));const i=t-this.height;for(;this.height!==t;)i>0?this.insert(this.height):this.delete(this.height-1)}get height(){return this._memory2D.length}get size(){return this.width*this.height}get order(){let t=0;return this.visit(()=>t++,({value:i})=>this.constructor.isFilled(i)),t}get mouseRow(){return this.screenRow(this._p.mouseY)}get mouseCol(){return this.screenCol(this._p.mouseX)}get span(){let t=this.height,i=-1,s=this.width,e=-1;if(this.visit(({row:n,col:o})=>{n<t&&(t=n),n>i&&(i=n),o<s&&(s=o),o>e&&(e=o)},({value:n})=>this.constructor.isFilled(n)),i!==-1)return{row:t,col:s,width:e-s+1,height:i-t+1}}magnitude(t){let i=0;if(this.isValid(t,0))for(let s=0;s<this.width;s++)this.isFilled(t,s)&&i++;return i}search(t,i=!1){const s=[];return this.visit(({row:e,col:n})=>this.constructor.merge(t,this,(o,h)=>{if(this.constructor.isFilled(o)&&(i?h!==o:this.constructor.isEmpty(h)))return o},-e,-n).order===0&&s.push({row:e,col:n})),s}screenRow(t,i=this._y||0,s=this._cellLength||this.constructor.cellLength){return this._p.floor((t-(this._origin==="center"?this._p.height/2:i))/s)}screenCol(t,i=this._x||0,s=this._cellLength||this.constructor.cellLength){return this._p.floor((t-(this._origin==="center"?this._p.width/2:i))/s)}read(t,i){if(this.isValid(t,i))return this._memory2D[t][i]}isValid(t,i){return t>=0&&t<this.height&&i>=0&&i<this.width}static isEmpty(t){return t==null}static isFilled(t){return t!=null}static isBoolean(t){return typeof t=="boolean"}static isSymbol(t){return typeof t=="symbol"}static isNumber(t){return typeof t=="number"}static isBigInt(t){return typeof t=="bigint"}static isString(t){return typeof t=="string"}static isColor(t){return t instanceof E.Color}static isFunction(t){return typeof t=="function"}static isImage(t){return t instanceof E.Image||t instanceof E.MediaElement&&t.elt instanceof HTMLVideoElement||t instanceof E.Graphics||t instanceof E.Framebuffer}static isArray(t){return Array.isArray(t)}static isObject(t){return this.isFilled(t)&&!this.isColor(t)&&!this.isImage(t)&&!this.isArray(t)&&!this.isFunction(t)&&typeof t=="object"}isEmpty(t,i){return this.constructor.isEmpty(this.read(t,i))}isFilled(t,i){return this.constructor.isFilled(this.read(t,i))}isBoolean(t,i){return this.constructor.isBoolean(this.read(t,i))}isSymbol(t,i){return this.constructor.isSymbol(this.read(t,i))}isNumber(t,i){return this.constructor.isNumber(this.read(t,i))}isBigInt(t,i){return this.constructor.isBigInt(this.read(t,i))}isString(t,i){return this.constructor.isString(this.read(t,i))}isColor(t,i){return this.constructor.isColor(this.read(t,i))}isArray(t,i){return this.constructor.isArray(this.read(t,i))}isObject(t,i){return this.constructor.isObject(this.read(t,i))}isImage(t,i){return this.constructor.isImage(this.read(t,i))}isFunction(t,i){return this.constructor.isFunction(this.read(t,i))}replace(...t){return t.length===1&&this.visit(({row:i,col:s})=>this.fill(i,s,t[0]),({value:i})=>this.constructor.isFilled(i)),t.length===2&&this.visit(({row:i,col:s})=>this.fill(i,s,t[1]),({value:i})=>i===t[0]),this}clear(...t){if(t.length===0&&(this._memory2D=this._memory2D.map(i=>i.map(s=>this._clearCell(s)))),t.length===1&&typeof t[0]=="function"&&this.visit(({row:i,col:s,value:e})=>{this._memory2D[i][s]=this._clearCell(e)},t[0]),t.length===1&&typeof t[0]=="number"&&this.isValid(t[0],0)&&(this._memory2D[t[0]]=this._memory2D[t[0]].map(i=>this._clearCell(i))),(t.length===1||t.length===2)&&typeof t[0]=="bigint"){const i=t[0],s=t[1]===!0;if(i<0n)console.warn("Bitboard cannot be negative");else{this.visit(({row:o,col:h})=>{const r=this.bitIndex(o,h,s);i&1n<<BigInt(r)&&(this._memory2D[o][h]=this._clearCell(this._memory2D[o][h]))},({value:o})=>this.constructor.isFilled(o));const e=i.toString(2).length,n=this.width*this.height;e>n&&console.warn(`Bitboard has ${e} bits but quadrille holds only ${n}. Increase quadrille width and/or height so that width * height ≥ ${e}.`)}}return t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"&&this.isValid(t[0],t[1])&&(this._memory2D[t[0]][t[1]]=this._clearCell(this._memory2D[t[0]][t[1]])),t.length===3&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="number"&&this.isValid(t[0],t[1])&&this._flood(t[0],t[1],this._memory2D[t[0]][t[1]],null,t[2]),t.length===3&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="boolean"&&this.isValid(t[0],t[1])&&this._flood(t[0],t[1],this._memory2D[t[0]][t[1]],null,4,t[2]),t.length===4&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="number"&&typeof t[3]=="boolean"&&this.isValid(t[0],t[1])&&this._flood(t[0],t[1],this._memory2D[t[0]][t[1]],null,t[2],t[3]),this}fill(...t){if(t.length===0&&this.visit(({row:i,col:s})=>{this._memory2D[i][s]=this._clearCell(this._memory2D[i][s]),this._memory2D[i][s]=this._p.color((i+s)%2===0?this.constructor.lightSquare:this.constructor.darkSquare)}),t.length===1&&this.constructor.isFilled(t[0])&&this.visit(({row:i,col:s})=>{this._memory2D[i][s]=this._parseFn(t[0],i,s)},({value:i})=>this.constructor.isEmpty(i)),t.length===2&&typeof t[0]=="function"&&this.constructor.isFilled(t[1])){const[i,s]=t;this.visit(({row:e,col:n})=>{this._memory2D[e][n]=this._clearCell(this._memory2D[e][n]),this._memory2D[e][n]=this._parseFn(s,e,n)},i)}if(t.length===2&&(this.constructor.isColor(t[0])||typeof t[0]=="string")&&(this.constructor.isColor(t[1])||typeof t[1]=="string")&&this.visit(({row:i,col:s})=>{this._memory2D[i][s]=this._clearCell(this._memory2D[i][s]),this._memory2D[i][s]=(i+s)%2===0?this._p.color(t[0]):this._p.color(t[1])}),t.length===2&&typeof t[0]=="number"&&this.isValid(t[0],0)){const i=t[0],s=t[1];this._memory2D[i]=this._memory2D[i].map((e,n)=>(e=this._clearCell(e),s===void 0?null:this._parseFn(s,i,n)))}if((t.length===2||t.length===3)&&typeof t[0]=="bigint"&&this.constructor.isFilled(t[1])){const i=t[0],s=t[1],e=t[2]===!0;i<0n?console.warn("Bitboard cannot be negative"):this.visit(({row:h,col:r})=>{const c=this.bitIndex(h,r,e);i&1n<<BigInt(c)&&(this._memory2D[h][r]=this._parseFn(s,h,r))},({value:h})=>this.constructor.isEmpty(h));const n=i.toString(2).length,o=this.width*this.height;n>o&&console.warn(`Bitboard has ${n} bits but quadrille holds only ${o}. Increase quadrille width and/or height so that width * height ≥ ${n}.`)}if(t.length===3&&typeof t[0]=="number"&&typeof t[1]=="number"&&this.isValid(t[0],t[1])){const[i,s,e]=t;this._memory2D[i][s]=this._clearCell(this._memory2D[i][s]),this._memory2D[i][s]=e===void 0?null:this._parseFn(e,i,s)}if(t.length===4&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[3]=="number"&&this.isValid(t[0],t[1])){const[i,s,e,n]=t;this._flood(i,s,this._memory2D[i][s],e===void 0?null:this._parseFn(e,i,s),n)}if(t.length===4&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[3]=="boolean"&&this.isValid(t[0],t[1])){const[i,s,e,n]=t;this._flood(i,s,this._memory2D[i][s],e===void 0?null:this._parseFn(e,i,s),4,n)}if(t.length===5&&typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[3]=="number"&&typeof t[4]=="boolean"&&this.isValid(t[0],t[1])){const[i,s,e,n,o]=t;this._flood(i,s,this._memory2D[i][s],e===void 0?null:this._parseFn(e,i,s),n,o)}return this}_parseFn(t,i,s){return typeof t=="function"&&t._isFactory?t({row:i,col:s}):t}_clearCell(t){return(this.constructor.isFunction(t)||this.constructor.isObject(t))&&(t.fbo?.remove(),t.fbo=void 0),null}_flood(t,i,s,e,n=4,o=!1){n!==4&&n!==8&&(console.warn(`flood fill is using 4 directions instead of ${n}, see: https://en.m.wikipedia.org/wiki/Flood_fill`),n=4),this.isValid(t,i)&&this._memory2D[t][i]!==e&&(this._memory2D[t][i]===s&&(this._memory2D[t][i]=this._clearCell(this._memory2D[t][i]),this._memory2D[t][i]=e,this._flood(t,i-1,s,e,n,o),this._flood(t-1,i,s,e,n,o),this._flood(t,i+1,s,e,n,o),this._flood(t+1,i,s,e,n,o),n===8&&(this._flood(t-1,i-1,s,e,n,o),this._flood(t-1,i+1,s,e,n,o),this._flood(t+1,i+1,s,e,n,o),this._flood(t+1,i-1,s,e,n,o))),o&&(this._memory2D[t][i]=this._clearCell(this._memory2D[t][i]),this._memory2D[t][i]=e))}rand(t,i=null){t=this._p.abs(t);const s=this.constructor.isFilled(i),e=s?this.size-this.order:this.order;t=this._p.min(t,e);let n=0;for(;n<t;){const o=this._p.int(this._p.random(this.size)),{row:h,col:r}=this._fromIndex(o);(s?this.isEmpty(h,r):this.isFilled(h,r))&&(s?this.fill(h,r,i):this.clear(h,r),n++)}return this}randomize(){const t=this.clone();return this.clear(),t.visit(({value:i})=>{let s,e;do{const n=this._p.int(this._p.random(this.size));({row:s,col:e}=this._fromIndex(n))}while(this.isFilled(s,e));this.fill(s,e,i)},({value:i})=>this.constructor.isFilled(i)),this}insert(t){return this._memory2D.splice(t,0,Array(this.width).fill(null)),this}delete(t){return this.height>1&&this.isValid(t,0)&&this._memory2D.splice(t,1),this}swap(...t){const i=Number.isInteger;if(t.length===2){if(t.every(i)&&this.isValid(t[0],0)&&this.isValid(t[1],0)){const s=this._memory2D[t[0]];this._memory2D[t[0]]=this._memory2D[t[1]],this._memory2D[t[1]]=s}}else if(t.length===4&&t.every(i)&&this.isValid(t[0],t[1])&&this.isValid(t[2],t[3])){const s=this._memory2D[t[0]][t[1]];this._memory2D[t[0]][t[1]]=this._memory2D[t[2]][t[3]],this._memory2D[t[2]][t[3]]=s}return this}shift(t,i,s=!0){if(this.order===0)return this;const e=this.width,n=this.height;let o=Number.isFinite(t)?Math.trunc(t):0,h=Number.isFinite(i)?Math.trunc(i):0;if(s&&(o=(o%n+n)%n,h=(h%e+e)%e),h===0&&o===0)return this;const r=this.toArray(),c=new Array(e*n).fill(null);if(s)for(let l=0;l<r.length;l++){const m=r[l];if(this.constructor.isFilled(m)){const{row:b,col:d}=this._fromIndex(l,e),u=(b+o)%n,f=(d+h)%e;c[this._toIndex(u,f,e)]=m}}else for(let l=0;l<r.length;l++){const m=r[l];if(this.constructor.isFilled(m)){const{row:b,col:d}=this._fromIndex(l,e),u=b+o,f=d+h;u>=0&&u<n&&f>=0&&f<e&&(c[this._toIndex(u,f,e)]=m)}}return this._init1D(c,e),this}not(t){return this.visit(({row:i,col:s,value:e})=>this.constructor.isFilled(e)?this.clear(i,s):this.fill(i,s,t)),this}and(t,i,s){return this.merge(t,(e,n)=>{if(this.constructor.isFilled(e)&&this.constructor.isFilled(n))return e},i,s)}or(t,i,s){return this.merge(t,(e,n)=>{if(this.constructor.isFilled(e))return e;if(this.constructor.isFilled(n))return n},i,s)}xor(t,i,s){return this.merge(t,(e,n)=>{if(this.constructor.isFilled(e)&&this.constructor.isEmpty(n))return e;if(this.constructor.isEmpty(e)&&this.constructor.isFilled(n))return n},i,s)}diff(t,i,s){return this.merge(t,(e,n)=>{if(this.constructor.isFilled(e)&&this.constructor.isEmpty(n))return e},i,s)}merge(t,i,s,e){const n=this._row!==void 0&&t._row!==void 0&&this._cellLength!==void 0&&this._cellLength===t._cellLength;s??=n?t._row-this._row:0,e??=n?t._col-this._col:0;const o=this.constructor;if(s===0&&e===0&&this.width===t.width&&this.height===t.height){const F=this.height,M=this.width,y=this._memory2D,a=t._memory2D;for(let x=0;x<F;x++){const C=y[x],w=a[x];for(let g=0;g<M;g++){const p=i(C[g],w[g]);C[g]=o.isFilled(p)?p:null}}return this}const h=e<0?Math.max(t.width,this.width-e):Math.max(this.width,t.width+e),r=s<0?Math.max(t.height,this.height-s):Math.max(this.height,t.height+s),c=this.height,l=this.width,m=t.height,b=t.width,d=s<0,u=s>0,f=e<0,_=e>0,A=o._allocNullMemory(r,h),I=this._memory2D,S=t._memory2D;for(let F=0;F<r;F++){const M=d?F+s:F,y=u?F-s:F,a=A[F],x=M>=0&&M<c?I[M]:null,C=y>=0&&y<m?S[y]:null;for(let w=0;w<h;w++){const g=f?w+e:w,p=_?w-e:w,D=x&&g>=0&&g<l?x[g]:void 0,k=C&&p>=0&&p<b?C[p]:void 0,v=i(D,k);a[w]=o.isFilled(v)?v:null}}return this._memory2D=A,this}reflect(){return this._memory2D.reverse(),this}transpose(){return this._memory2D=this._memory2D[0].map((t,i)=>this._memory2D.map(s=>s[i])),this}rotate(){return this._memory2D=this._memory2D[0].map((t,i)=>this._memory2D.map(s=>s[i]).reverse()),this}toBigInt(t=!1){let i=0n;const s=this.width*this.height;let e=0;return this.visit(({row:n,col:o})=>{const h=t?e:s-1-e;this.constructor.isFilled(this.read(n,o))&&(i|=1n<<BigInt(h)),e++}),i}toArray(){return this._memory2D.flat()}toImage(t,{filter:i,textFont:s,origin:e="corner",options:n={},tileDisplay:o,functionDisplay:h,imageDisplay:r,colorDisplay:c,stringDisplay:l,numberDisplay:m,bigintDisplay:b,booleanDisplay:d,symbolDisplay:u,arrayDisplay:f,objectDisplay:_,cellLength:A=this._cellLength||this.constructor.cellLength,outlineWeight:I,outline:S,textColor:F,textZoom:M}={}){const y=this._p.createGraphics(this.width*A,this.height*A,this._mode);this._p.drawQuadrille(this,{graphics:y,filter:i,tileDisplay:o,functionDisplay:h,imageDisplay:r,colorDisplay:c,stringDisplay:l,numberDisplay:m,bigintDisplay:b,booleanDisplay:d,symbolDisplay:u,arrayDisplay:f,objectDisplay:_,cellLength:A,outlineWeight:I,outline:S,textColor:F,textZoom:M,textFont:s,origin:e,options:n}),this._p.save(y,t)}toFEN(){if(this.width!==8||this.height!==8){console.warn("toFEN() only works on 8x8 chess boards");return}const t=this.constructor.chessKeys;let i="";for(let s=0;s<8;s++){let e=0;for(let n=0;n<8;n++){const o=this._memory2D[s][n];if(this.constructor.isEmpty(o))e++;else{e>0&&(i+=e,e=0);const h=t.get(o);i+=h??(console.warn(`Unrecognized piece ${o} at ${s}, ${n}`),"?")}}e>0&&(i+=e),s<7&&(i+="/")}return i}clone(){const t=this.height,i=this._memory2D,s=new Array(t);for(let n=0;n<t;n++)s[n]=i[n].slice();const e=Object.create(N.prototype);return e._p=this._p,e._memory2D=s,e._cellLength=this._cellLength,e._x=this._x,e._y=this._y,e._col=this._col,e._row=this._row,e._origin=this._origin,e}crop(t,i,s,e,n=!1){if(!Number.isFinite(s)||!Number.isFinite(e)||s===0||e===0){console.warn("Quadrille.crop skipped: width/height must be finite and non-zero");return}const o=Math.abs(s),h=Math.abs(e),r=e>0?t:t-(h-1),c=s>0?i:i-(o-1),l=this.height,m=this.width,b=this.constructor,d=b._allocNullMemory(h,o);if(n){const u=(f,_)=>(f%_+_)%_;for(let f=0;f<h;f++){const _=u(r+f,l);for(let A=0;A<o;A++){const I=u(c+A,m),S=this.read(_,I);d[f][A]=b.isFilled(S)?S:null}}}else for(let u=0;u<h;u++)for(let f=0;f<o;f++){const _=this.read(r+u,c+f);d[u][f]=b.isFilled(_)?_:null}return b._allocQ(this,d)}trim(){const t=this.span;return t?this.crop(t.row,t.col,t.width,t.height):void 0}ring(t,i,...s){const[e,n]=s,o=typeof n=="number"?n:typeof e=="number"?e:1,h=typeof n=="boolean"?n:typeof e=="boolean"?e:!1;if(!Number.isFinite(o)||o<0){console.warn("Quadrille.ring skipped: dimension must be finite and >= 0");return}const r=2*o+1;return this.crop(t-o,i-o,r,r,h)}row(t){if(!this.isValid(t,0))return;const i=this._memory2D[t];return this.constructor._allocQ(this,[i.slice()])}filter(t,i,s){if(t.size%2===1&&t.width===t.height&&this.size>=t.size){const e=(t.width-1)/2;if(i===void 0||s===void 0){const n=this.clone();this.visit(({row:o,col:h})=>this._conv(t,o,h,e,n),({row:o,col:h})=>o>=e&&o<this.height-e&&h>=e&&h<this.width-e)}else i>=e&&i<this.height-e&&s>=e&&s<this.width-e&&this._conv(t,i,s,e)}return this}_conv(t,i,s,e=(t.width-1)/2,n=this){let o=0,h=0,r=0,c;for(let l=0;l<t.height;l++)for(let m=0;m<t.width;m++){const b=i+l-e,d=s+m-e,u=n.read(b,d);let f=t.read(l,m);if(this.constructor.isColor(u)&&(typeof f=="number"||this.constructor.isColor(f))){c=!0;const _=typeof f=="number"?f:.299*this._p.red(f)+.587*this._p.green(f)+.114*this._p.blue(f);o+=this._p.red(u)*_,h+=this._p.green(u)*_,r+=this._p.blue(u)*_}}c&&(o=this._p.constrain(o,0,255),h=this._p.constrain(h,0,255),r=this._p.constrain(r,0,255),this.fill(i,s,this._p.color(o,h,r)))}colorizeTriangle(t,i,s,e,n,o,h,r=h,c=h){this.rasterizeTriangle(t,i,s,e,n,o,({array:l})=>this._p.color(l),[this._p.red(h),this._p.green(h),this._p.blue(h),this._p.alpha(h)],[this._p.red(r),this._p.green(r),this._p.blue(r),this._p.alpha(r)],[this._p.red(c),this._p.green(c),this._p.blue(c),this._p.alpha(c)])}colorize(t,i=t,s=t,e=t){this.colorizeTriangle(0,0,this.height-1,0,0,this.width-1,t,i,s),this.colorizeTriangle(this.height-1,0,0,this.width-1,this.height-1,this.width-1,i,s,e)}rasterizeTriangle(t,i,s,e,n,o,h,r,c=r,l=r){return Array.isArray(r)&&Array.isArray(c)&&Array.isArray(l)&&this.visit(({row:m,col:b})=>{const d=this._barycentric_coords(m,b,t,i,s,e,n,o);if(d.w0>=0&&d.w1>=0&&d.w2>=0){const u=Math.max(r.length,c.length,l.length),f=new Array(u);for(let _=0;_<f.length;_++)f[_]=(r[_]??0)*d.w0+(c[_]??0)*d.w1+(l[_]??0)*d.w2;this.fill(m,b,h({array:f,row:m,col:b}))}}),this}rasterize(t,i,s=i,e=i,n=i){this.rasterizeTriangle(0,0,this.height-1,0,0,this.width-1,t,i,s,e),this.rasterizeTriangle(this.height-1,0,0,this.width-1,this.height-1,this.width-1,t,s,e,n)}_barycentric_coords(t,i,s,e,n,o,h,r){const c=this._edge_functions(t,i,s,e,n,o,h,r),l=this._parallelogram_area(s,e,n,o,h,r);return{w0:c.e12/l,w1:c.e20/l,w2:c.e01/l}}_parallelogram_area(t,i,s,e,n,o){return(e-i)*(n-t)-(o-i)*(s-t)}_edge_functions(t,i,s,e,n,o,h,r){const c=(s-n)*i+(o-e)*t+(e*n-s*o),l=(n-h)*i+(r-o)*t+(o*h-n*r),m=(h-s)*i+(e-r)*t+(r*s-h*e);return{e01:c,e12:l,e20:m}}sort({mode:t="LUMA",target:i=this.constructor.outline,ascending:s=!0,textColor:e,textZoom:n,background:o,cellLength:h=this._p.int(this._p.max(this._p.width/this.width,this._p.height/this.height)/10),outlineWeight:r,outline:c,textFont:l,origin:m,options:b,imageDisplay:d,colorDisplay:u,stringDisplay:f,numberDisplay:_,bigintDisplay:A,booleanDisplay:I,symbolDisplay:S,arrayDisplay:F,objectDisplay:M,functionDisplay:y,tileDisplay:a}={}){let x=this.toArray();const C={background:o,cellLength:h,textColor:e,textZoom:n,imageDisplay:d,colorDisplay:u,outline:c,textFont:l,origin:m,options:b,outlineWeight:r,stringDisplay:f,numberDisplay:_,bigintDisplay:A,booleanDisplay:I,symbolDisplay:S,arrayDisplay:F,objectDisplay:M,functionDisplay:y,tileDisplay:a,renderer:"p2d"};switch(t){case"DISTANCE":x.sort((w,g)=>{C.value=w;const p=this.constructor.sample({...C,value:w}),D=this.constructor.sample({...C,value:g}),k=Math.sqrt(Math.pow(p.r/p.total-this._p.red(i),2)+Math.pow(p.g/p.total-this._p.green(i),2)+Math.pow(p.b/p.total-this._p.blue(i),2)+Math.pow(p.a/p.total-this._p.alpha(i),2)),v=Math.sqrt(Math.pow(D.r/D.total-this._p.red(i),2)+Math.pow(D.g/D.total-this._p.green(i),2)+Math.pow(D.b/D.total-this._p.blue(i),2)+Math.pow(D.a/D.total-this._p.alpha(i),2));return k-v});break;case"AVG":x.sort((w,g)=>{const p=this.constructor.sample({...C,value:w}),D=this.constructor.sample({...C,value:g}),k=.333*p.r+.333*p.g+.333*p.b,v=.333*D.r+.333*D.g+.333*D.b;return k-v});break;default:x.sort((w,g)=>{const p=this.constructor.sample({...C,value:w}),D=this.constructor.sample({...C,value:g}),k=.299*p.r+.587*p.g+.114*p.b,v=.299*D.r+.587*D.g+.114*D.b;return k-v});break}return this._init1D(x=s?x:x.reverse(),this.width),this}static sample({value:t,textFont:i,origin:s="corner",options:e={},renderer:n="p2d",imageDisplay:o=this.imageDisplay,colorDisplay:h=this.colorDisplay,stringDisplay:r=this.stringDisplay,numberDisplay:c=this.numberDisplay,bigintDisplay:l=this.bigintDisplay,booleanDisplay:m=this.booleanDisplay,symbolDisplay:b,arrayDisplay:d,objectDisplay:u,functionDisplay:f=this.functionDisplay,tileDisplay:_=this.tileDisplay,background:A=this.background,cellLength:I=this.cellLength,outlineWeight:S=this.outlineWeight,outline:F=this.outline,textColor:M=this.textColor,textZoom:y=this.textZoom}={}){const a=createGraphics(I,I,n);a.background(A);const x={graphics:a,value:t,textColor:M,textZoom:y,outline:F,outlineWeight:S,cellLength:I,textFont:i,origin:s,options:e,imageDisplay:o,colorDisplay:h,stringDisplay:r,numberDisplay:c,bigintDisplay:l,booleanDisplay:m,symbolDisplay:b,arrayDisplay:d,objectDisplay:u,functionDisplay:f,tileDisplay:_};this._display(x),a.loadPixels();let C=0,w=0,g=0,p=0;const D=a.pixels.length/4;for(let k=0;k<D;k++)C+=a.pixels[4*k],w+=a.pixels[4*k+1],g+=a.pixels[4*k+2],p+=a.pixels[4*k+3];return a.updatePixels(),{r:C,g:w,b:g,a:p,total:D}}static _display(t){const{value:i,objectDisplay:s}=t;this.isObject(i)&&s===void 0&&"display"in i&&(t._this=i,t.value=i.display);const e=[{check:this.isFunction.bind(this),display:t.functionDisplay},{check:this.isImage.bind(this),display:t.imageDisplay},{check:this.isColor.bind(this),display:t.colorDisplay},{check:this.isNumber.bind(this),display:t.numberDisplay},{check:this.isBigInt.bind(this),display:t.bigintDisplay},{check:this.isString.bind(this),display:t.stringDisplay},{check:this.isBoolean.bind(this),display:t.booleanDisplay},{check:this.isSymbol.bind(this),display:t.symbolDisplay},{check:this.isArray.bind(this),display:t.arrayDisplay},{check:this.isObject.bind(this),display:t.objectDisplay}];for(const n of e)if(n.check(t.value)&&n.display){n.display.call(this,t);break}t.tileDisplay&&t.tileDisplay.call(this,t)}static numberDisplay({graphics:t,value:i,cellLength:s=this.cellLength}={}){this.colorDisplay({graphics:t,value:t.color(i),cellLength:s})}static bigintDisplay({graphics:t,value:i,cellLength:s=this.cellLength}={}){this.numberDisplay({graphics:t,value:Number(i),cellLength:s})}static colorDisplay({graphics:t,value:i,cellLength:s=this.cellLength}={}){t.noStroke(),t.fill(i),t.rect(0,0,s,s)}static functionDisplay({mode:t,graphics:i,options:s,value:e,cellLength:n=this.cellLength,_this:o}={}){if(t==="webgl"){const h=(o??e).fbo??=i.createFramebuffer({width:n,height:n}),r=h.graphics??(h.graphics=i);h.begin(),r.clear(),r._rendererState=r.push(),s?.origin==="corner"&&r.translate(-n/2,-n/2),e.call(o??r,s),r.pop(r._rendererState),h.end(),this.imageDisplay({graphics:i,cellLength:n,value:h})}else i.push(),s?.origin==="center"&&i.translate(n/2,n/2),e.call(o??i,s),i.pop()}static imageDisplay({graphics:t,value:i,cellLength:s=this.cellLength}={}){const e=i instanceof E.Framebuffer&&(i.graphics||=t)!==t?(console.debug("fbo reformat needed"),i.get()):i;t.noStroke(),t.image(e,0,0,s,s)}static booleanDisplay({graphics:t,value:i,textFont:s,cellLength:e=this.cellLength,textColor:n=this.textColor,textZoom:o=this.textZoom}={}){this.stringDisplay({graphics:t,value:i?"✅":"❎",textFont:s,cellLength:e,textColor:n,textZoom:o})}static stringDisplay({graphics:t,value:i,textFont:s,cellLength:e=this.cellLength,textColor:n=this.textColor,textZoom:o=this.textZoom}={}){s&&t.textFont(s),t.noStroke(),t.fill(n),t.textSize(e*o/i.length),t.textAlign("center","center"),t.text(i,0,0,e,e)}static tileDisplay({graphics:t,cellLength:i=this.cellLength,outline:s=this.outline,outlineWeight:e=this.outlineWeight}={}){e!==0&&(t.noFill(),t.stroke(s),t.strokeWeight(e),t.quad(0,0,i,0,i,i,0,i))}}E.registerAddon((L,t)=>{t.createQuadrille=function(...i){return new N(this,...i)},t.drawQuadrille=function(i,{graphics:s=this,x:e,y:n,row:o,col:h,filter:r,textFont:c,origin:l,options:m={},functionDisplay:b=i.constructor.functionDisplay,imageDisplay:d=i.constructor.imageDisplay,colorDisplay:u=i.constructor.colorDisplay,stringDisplay:f=i.constructor.stringDisplay,numberDisplay:_=i.constructor.numberDisplay,tileDisplay:A=i.constructor.tileDisplay,booleanDisplay:I=i.constructor.booleanDisplay,bigintDisplay:S=i.constructor.bigintDisplay,symbolDisplay:F,arrayDisplay:M,objectDisplay:y,cellLength:a=i.constructor.cellLength,outlineWeight:x=i.constructor.outlineWeight,outline:C=i.constructor.outline,textColor:w=i.constructor.textColor,textZoom:g=i.constructor.textZoom}={}){i._mode=s._renderer instanceof L.RendererGL?"webgl":"p2d",l??=i._mode==="webgl"?"center":"corner",i._origin=l,m.origin??=i._mode==="webgl"?"center":"corner",i._cellLength=a,i._x=e??(h!=null?h*a:0),i._y=n??(o!=null?o*a:0);const p=i._x/a,D=i._y/a;return i._col=Number.isInteger(h)?h:Number.isInteger(p)?p:void 0,i._row=Number.isInteger(o)?o:Number.isInteger(D)?D:void 0,s.push(),i._mode==="webgl"?l==="corner"&&s.translate(-s.width/2,-s.height/2):l==="center"&&s.translate(s.width/2,s.height/2),s.translate(i._x,i._y),i.visit(({row:k,col:v,value:Q})=>{s.push(),s.translate(v*a,k*a),m.row=k,m.col=v;const z={value:Q,quadrille:i,graphics:s,options:m,origin:l,row:k,col:v,width:i.width,height:i.height,mode:i._mode,outline:C,outlineWeight:x,cellLength:a,textColor:w,textZoom:g,textFont:c,functionDisplay:b,imageDisplay:d,colorDisplay:u,stringDisplay:f,booleanDisplay:I,numberDisplay:_,bigintDisplay:S,arrayDisplay:M,objectDisplay:y,tileDisplay:A,symbolDisplay:F};i.constructor._display(z),s.pop()},r),s.pop(),i}});const J={class:"flex flex-col items-center"},q={__name:"QuadrilleChess",setup(L){B();const t=T(null);let i=null;const s=e=>{N.cellLength=40;const n=8,o=8;let h,r,c,l,m;const b="r3kb1r/ppN1pppp/5n2/8/8/8/PPP3PP/R3KB1R";let d,u,f;const _=N.chessSymbols.get("r"),A=N.chessSymbols.get("k"),I=N.chessSymbols.get("N");e.setup=()=>{e.createCanvas((2*n+1)*N.cellLength,(o+1)*N.cellLength).parent(t.value),d=e.createInput(),d.parent(t.value),d.size(8*N.cellLength-5),d.style("position","absolute"),d.style("left",`${9*N.cellLength+5}px`),d.style("top",`${8*N.cellLength+15}px`),d.changed(M),u=e.createSelect(),u.parent(t.value),u.option("clear");for(const a of N.chessSymbols.values())u.option(a);u.selected("clear"),u.style("position","absolute"),u.style("left","10px"),u.style("top",`${8*N.cellLength+15}px`),h=e.createQuadrille(),F()},e.draw=()=>{if(e.background("darkkhaki"),e.drawQuadrille(h,{tileDisplay:0}),e.drawQuadrille(r,{textColor:"black",tileDisplay:0}),c&&e.drawQuadrille(c,{tileDisplay:0}),e.drawQuadrille(h,{col:9,tileDisplay:0}),e.drawQuadrille(l,{col:9,textColor:"black",tileDisplay:0}),f&&f.length>0){const y=f[0];e.drawQuadrille(m,{row:y.row,col:9+y.col,outline:"magenta",outlineWeight:4,tileDisplay:S})}};function S({graphics:y,cellLength:a,row:x,col:C,width:w,height:g,outline:p,outlineWeight:D}){x===0&&C===0&&(y.noFill(),y.stroke(p),y.strokeWeight(D),y.rect(0,0,w*a,g*a))}const F=()=>{d.value(b),l=e.createQuadrille(d.value()),r=e.createQuadrille(8,8),r.fill(3,1,_),r.fill(3,5,A),r.fill(4,3,I),M()},M=()=>{l=e.createQuadrille(d.value()),f=[];const y=r.trim();if(c=void 0,y){f=l.search(y,!0),m=N.not(y,e.color(0,180));const a=y.fill(1),x=r.span;c=N.or(e.createQuadrille(8,8),a,x.row,x.col),c.not(e.color(0,180))}};e.keyPressed=()=>{e.key.toLowerCase()==="r"&&F()},e.mouseClicked=()=>{const y=r.mouseRow,a=r.mouseCol;r.isValid(y,a)&&(u.value()==="clear"?r.clear(y,a):r.fill(y,a,u.value()),M())}};return R(()=>{i=new E(s,t.value)}),W(()=>{i&&i.remove()}),(e,n)=>($(),P("div",J,[j("div",{ref_key:"sketchContainer",ref:t,class:"relative border-4 border-stone-800 shadow-xl overflow-hidden rounded-lg"},null,512),n[0]||(n[0]=j("p",{class:"mt-12 text-sm opacity-60 italic"}," Set a pattern on the left to search for it on the FEN board on the right ",-1))]))}},rt={__name:"slides.md__slidev_10",setup(L){const{$clicksContext:t,$frontmatter:i}=B();return t.setup(),(s,e)=>{const n=q;return $(),O(Y,U(K(V(X)(V(i),9))),{default:H(()=>[e[0]||(e[0]=j("h1",null,"Chess Pattern Recognition",-1)),e[1]||(e[1]=j("p",null,[Z("Detection of tactical motifs in chess using "),j("a",{href:"https://objetos.github.io/p5.quadrille.js/",target:"_blank"},"p5.quadrille.js")],-1)),G(n)]),_:1},16)}}};export{rt as default};
